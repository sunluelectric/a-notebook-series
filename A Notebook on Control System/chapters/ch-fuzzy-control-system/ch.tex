\chapter{Fuzzy Control System} \label{ch:fcs}

Fuzzy logics provide a way of quantitatively interpreting and calculating attributes or reasonings described by vague languages. In contrast to classical control methods where variables are numbered precisely and control laws described clearly by mathematical equations, a fuzzy controller uses objective terms such as ``good'', ``bad'', ``high'', ``low'', ``very'', ``a little'' to describe variables, and use rules ``if something then something'' to determine the control signals. This makes a fuzzy controller naturally good at realizing human knowledge base into practice.

Different from ANN which is highly data driven and requires a lot of samples and computations to train a network, a fuzzy controller is an expert-based system that requires only the membership functions used for fuzzification of variables and a set of rules for inference. ANN may reveal the building bricks of a human brain, while fuzzy control system reflects how a human interprets the knowledge that he learns from past experience and uses in his daily life. This feature of a fuzzy control system is a bless and a curse at the same time. Fuzzy control system does not rely on training, thus is handy when there are few training samples. On the other hand, this also means that it cannot benefit from the accumulation of the samples and it is lack of evolving capability comparing with ANN and other evolutionary algorithms.

\section{Fuzzy Set and Fuzzy Relation}

Fuzzy set is not a set from mathematical perspective, but a projection derived from a set. Fuzzy set and fuzzy relation are the fundamentals of fuzzy logics. Details are given in the remaining of this section.

\subsection{Fuzzy Set}

The fundamentals of fuzzy logics and fuzzy control systems are built on fuzzy set and membership function. Fuzzy set is not a set from mathematical perspective, but a projection from a set to a real number between $[0, 1]$. The function used in the projection is called the member function of the fuzzy set.

Consider set $U$ with finite or infinite cardinality. Define a projection $\mu_{\utilde{A}}$ from $x \in U$ to $[0, 1]$ as follows.
\begin{eqnarray}
	\mu_{\utilde{A}} &:& x \in U \rightarrow [0, 1] \nonumber
\end{eqnarray}
This projection, together with its domain (also known as the universe of a fuzzy set) defines a fuzzy set. The projection $\mu_{\utilde{A}}$ is called the membership function of the fuzzy set $\utilde{A}$. The value of $\mu_{\utilde{A}}(x)$ for $x \in U$ describes in what extent $x$ belongs to $\utilde{A}$.

It is clear from the definition the difference between a set and a fuzzy set. For a set, an element either belongs to the set or does not belong to the set, which can be described by
\begin{eqnarray}
	\mu_{A}(x) = \left\{\begin{array}{cc}
		1 & x \in A \\
		0 & x \notin A
	\end{array}\right. \nonumber
\end{eqnarray}
where $\mu_{A}$ is a binary function. In contrast, fuzzy set defines a continuous functions $\mu_{\utilde{A}}$ which can take any value between $[0,1]$. From this stand, a fuzzy set is an extension to a set.

An example of a fuzzy set is given below. Let $U\geq 0$ be the age of a person. Define 2 fuzzy sets, ``young adult'' as $\utilde{A}$ and ``middle-aged adult'' as $\utilde{B}$, with membership function defined in Fig. \ref{ch:fcs:fig:fuzzysetexp}.

\begin{figure}
	\centering
	\includegraphics[width=250pt]{chapters/ch-fuzzy-control-system/figures/fuzzysetexp.eps}
	\caption{Membership function of fuzzy sets ``young adult'' and ``middle-aged adult''.} \label{ch:fcs:fig:fuzzysetexp}
\end{figure}

From Fig. \ref{ch:fcs:fig:fuzzysetexp}, we can see how a person is categorized according to the age. For example, a 5-year-old child is by no means a young adult or an adult, as $\mu_{A}=\mu_{B}(5)=0$ from the figure. A 27-year-old can be considered ``quite'' a young adult, with $\mu_{A}=0.8$, and ``somehow'' adult, with $\mu_{A}=0.3$.

The maximum value of a membership function is defined as the height of the fuzzy set. In many occasions the height is $1$, but it is not always the case. An element whose associated membership function equals to half of the height is called the crossover point.

It is possible to set up a threshold for the membership function, and derive a set from a fuzzy set as follows.
\begin{eqnarray}
	\utilde{A}_\alpha &=& \left\{x \middle| \mu_{\utilde{A}} (e) \geq \alpha \right\} \nonumber
\end{eqnarray}
Notice that $\utilde{A}_\alpha$ is a set (not a fuzzy set) known as the cut set of $\utilde{A}$. A fuzzy set can have infinite number of cut sets by choosing different $\alpha$. A fuzzy set can be derived from all its cut sets as follows.
\begin{eqnarray}
	\utilde{A} &=& \bigcup_{\alpha \in [0, 1]} \alpha A_\alpha \nonumber
\end{eqnarray}
where $\alpha A_\alpha$ is a fuzzy set defined on $A_\alpha$ with, universe $A_\alpha$ and membership function value $\alpha$. The $\cup$ calculates the union of fuzzy sets, more of which is introduced later.

Define the support and core of a fuzzy set as follows, respectively.
\begin{eqnarray}
	\textup{supp}(\utilde{A}) &=& \left\{x \middle| \mu_{\utilde{A}}(x) > 0 \right\} \nonumber \\
	C(\utilde{A}) &=& \left\{x \middle| \mu_{\utilde{A}}(x) = 1 \right\} \nonumber
\end{eqnarray}

A fuzzy set $\utilde{A}$ can be represented by its base set $A$ together with associated membership functions $\mu_{\utilde{A}}$. Alternatively, use the following
\begin{eqnarray}
	\utilde{A} &=& \sum_{i} \dfrac{\mu_{\utilde{A}}(x_i)}{x_i} \nonumber \\
	\utilde{A} &=& \int_{E} \dfrac{\mu_{\utilde{A}}(x)}{x} \nonumber
\end{eqnarray}
to represent a fuzzy set with discrete and continuous universe, respectively. Notice that in the above representation, ``$/$'', ``$\sum$'', and ``$\int$'' are not division, summation and integration, but just conventional notations used in the fuzzy set theory.

\subsection{Fuzzy Set Operations}

Operations such as union and intersection are defined on fuzzy sets. They are summarized in Table \ref{ch:fcs:tab:fuzzysetoperation}.

\begin{table}[h]
	\centering
	\begin{tabular}{lll}
		\hline
		Operation & Symbol & Membership Function \\
		\hline
		Union & $\utilde{A} \cup \utilde{B}$ & $\mu_{\utilde{A} \cup \utilde{B}}(e) = \max(\mu_{\utilde{A}}(e), \mu_{\utilde{B}}(e))$ \\
		Intersection & $\utilde{A} \cap \utilde{B}$ & $\mu_{\utilde{A} \cap \utilde{B}}(e) = \min(\mu_{\utilde{A}}(e), \mu_{\utilde{B}}(e))$ \\
		Complement & $\utilde{A}'$ & $\mu_{\utilde{A}'}(e) = 1 - \mu_{\utilde{A}}(e)$ \\
		\hline
	\end{tabular}
	\caption{Commonly used fuzzy set operations.}
	\label{ch:fcs:tab:fuzzysetoperation}
\end{table}

Notice that Table \ref{ch:fcs:tab:fuzzysetoperation} gives only one out of many ways to define these operations. There are other ways to define them. For example, for complement, there is Sugeno's complement and Yager's complement as follows. The ones given in Table \ref{ch:fcs:tab:fuzzysetoperation} is the most commonly used definition.
\begin{eqnarray}
	N_s(e) &=& \dfrac{1-e}{1+\lambda e} \nonumber \\
	N_w(e) &=& (1-a^w)^{\frac{1}{w}} \nonumber
\end{eqnarray}

More operations can be found in \cite{mizumoto1981fuzzy}.

\subsection{Commonly Used Membership Functions}

Membership functions can be chosen flexibly as long as it is bounded by $[0, 1]$ for each element. There are some commonly used ones that has been proved useful in general problems as shown in Fig. \ref{ch:fcs:fig:commonmf}. They, together with their combinations, are widely used in fuzzy control system design.

\begin{figure}
	\centering
	\includegraphics[width=350pt]{chapters/ch-fuzzy-control-system/figures/commonmf.png}
	\caption{Commonly used membership functions.} \label{ch:fcs:fig:commonmf}
\end{figure}

MATLAB provides built-in functions to generate the functions in \ref{ch:fcs:fig:commonmf}, such as \verb|trimf| for triangular membership function, \verb|trapmf| for trapezoidal function, \verb|gaussmf| for Gaussian, and \verb|gbellmf| for generalized-bell function, respectively. There are other membership functions built-in to MATLAB as well.

\subsection{Fuzzy Relation}

In set theory, a relation of two elements is defined using sets. For example, let $a, b \in \mathbb{R}$. Let a customized relation ``$\oplus$'' be defined on $\mathbb{R} \times \mathbb{R} = \mathbb{R}^2$. We can say $a \oplus b$ if and only if there is a set defined on $\mathbb{R}^2$ associated with ``$\oplus$'' relation, and $(a,b)$ is in that set. Here ``$\times$'' denotes the Cartesian product.

Fuzzy relation is defined likewise, except that the set is replaced with fuzzy set as follows. Let $u\in U$, $v \in V$ be two variables with the same or different domains, and $D=U \times V$. The fuzzy relation of ``$\oplus$'' of two elements $u$ and $v$ is defined by the following fuzzy set
\begin{eqnarray}
	\mu_{\utilde{D}} (u,v) &\in& [0, 1] \nonumber
\end{eqnarray}
associated with ``$\oplus$''.

It is possible to use a matrix to record the fuzzy relations, in which case the matrix is called a fuzzy matrix as it is made up of membership functions. Other choice include fuzzy graph, which takes advantage of graph theory to represent the fuzzy relation of different nodes in a universe.

The relation can be derived from chains. For example, consider relation $P$ defined one $X \times Y$, and $Q$ on $Y \times Z$. A relation on $X, Z$ can be derived. One way (this is not the only way) is to use
\begin{eqnarray}
	\mu_{X \times Z}(x, z) &=& \sup \left[\min\left(\mu_{X\times Y}(x, y), \mu_{Y\times Z} (y, z)\right)\right] \nonumber
\end{eqnarray}

\section{Fuzzy Control System}

Fuzzy control system is a practice of utilizing fuzzy logics in engineering. It mainly includes fuzzification of the physical measurement signals to fuzzy variables, fuzzy inference, and defuzzification of the fuzzy variables to physical control signals. Membership functions are used in the fuzzification and defuzzification of signals, and rules are used in the fuzzy inference.

A simple schema of a fuzzy control system is given in Fig. \ref{ch:fcs:fig:fuzzyschemasimple}. Details are covered in the remaining of this section.

\begin{figure}
	\centering
	\includegraphics[width=350pt]{chapters/ch-fuzzy-control-system/figures/fuzzyschemasimple.png}
	\caption{A simple schema for a fuzzy control system.}
	\label{ch:fcs:fig:fuzzyschemasimple}
\end{figure}

\subsection{Fuzzification}

xxx

\subsection{Fuzzy Interface}

xxx

\subsection{Fuzzy Controller Design}

xxx

\subsection{Fuzzy Controller Performance Analysis}

xxx

\section{Fuzzy Modeling and Fuzzy System Identification}

xxx

\section{Fuzzy Control System Design Using MATLAB}

MATLAB fuzzy logic toolbox provides tools to define membership functions and fuzzy inference systems. They are introduced in this section via examples.

\subsection{Example: Calculate Tips in a Restaurant}

Consider the example given below.

\begin{shortbox}
\Boxhead{A Motivating Example}

The tips that a customer pays to the waiter/waitress in a restaurant depends on the quality of the food and the service as demonstrated in Fig. \ref{ch:fcs:fig:expmotivating}.

There is no quantitative standard for the quality of the food, nor the service. It is more about the feelings of the customers. Neither is there a fixed guidance that maps them to the tips, i.e., some customers may take food and service equality important, while others may think one more significant than the other.

Try to describe tips as a function of food and service quality.

\end{shortbox}

\begin{figure}
	\centering
	\includegraphics[width=250pt]{chapters/ch-fuzzy-control-system/figures/expmotivating.png}
	\caption{Tips relate to food and service quality.} \label{ch:fcs:fig:expmotivating}
\end{figure}

Solving the above problem using conventional methods requires precise modeling of how the customer's utility relates to food and service quality. An example is given below, where the utilities the customer gets from the service and food qualities modeled using an exponential function and a linear function, respectively. Finally, the tips are determined by a weighted sum of the utilities.
\begin{eqnarray}
	u_1 &=& \dfrac{e^{x_1}-1}{e-1} \nonumber \\
	u_2 &=& x_2 \nonumber \\
	u &=& 0.8 u_1 + 0.2 u_2 \nonumber \\
	\textup{tips} &=& (0.25-0.05)u + 0.05 \nonumber
\end{eqnarray}
where $x_1\in [0,1]$ and $x_2 \in [0,1]$ are used to characterize the service and food qualities, respectively. The result is given in plotted in Fig. \ref{ch:fcs:fig:motivatingexp_conventional}. It can be seen that although this is a common practical problem of daily life and a human can solve it almost immediately, the modeling and realization of the solution using conventional control method can be difficult. The conventional method, in this case, is non-intuitive and differs largely from how human would naturally handle this problem.

\begin{figure}
	\centering
	\includegraphics[width=250pt]{chapters/ch-fuzzy-control-system/figures/motivatingexp_conventional.eps}
	\caption{Tips as a deterministic function of service and food qualities.} \label{ch:fcs:fig:motivatingexp_conventional}
\end{figure}

MATLAB fuzzy control toolbox provides variety of tools to design and demonstrate fuzzy controllers. For the aforementioned problem, a built-in fuzzy interface system (FIS) named ``tipper'' is defined. A fuzzy inference is the process of formulating the mapping from a given input to an output using fuzzy logics. More details of FIS is introduced elsewhere in this chapter.

In tipper, 3 fizzy variables (2 inputs, 1 output) and 3 rules are defined. The result is plotted in Fig. \ref{ch:fcs:fig:motivatingexp_fis}. By comparing Figs. \ref{ch:fcs:fig:motivatingexp_conventional} and \ref{ch:fcs:fig:motivatingexp_fis}, it can be seen that fuzzy logics can interpret ``good service'', ``bad service'', etc., in a more intuitive way close to human, and it can formulate more complicated behavior with simpler setup. It requires rules instead of tons of samples (for training) to form this behavior.

\begin{figure}
	\centering
	\includegraphics[width=250pt]{chapters/ch-fuzzy-control-system/figures/motivatingexp_fis.eps}
	\caption{Tips as a deterministic function of service and food qualities using fuzzy logic.} \label{ch:fcs:fig:motivatingexp_fis}
\end{figure}

\subsection{Defining Membership Functions for Fuzzy Sets}

Consider the following example.

\begin{shortbox}
	\Boxhead{Fuzzy Sets Creation}
	
	Define the following fuzzy sets in MATLAB. Let both $\utilde{A}$, $\utilde{B}$ be fuzzy sets with triangular membership function. Let $\utilde{C} = \utilde{A} + \utilde{B}$ whose elements are obtained by adding elements in $\utilde{A}$ and $\utilde{B}$.
	
\end{shortbox}

Create $\utilde{A}$ and $\utilde{B}$ as follows. Their membership function is plotted in Fig. \ref{ch:fcs:fig:exp_createfuzzyset} as the red and blue lines, respectively.
\begin{lstlisting}[style=Matlab-editor]
x = 0:0.01:10;
trimf_a = @(x) 0.9*trimf(x, [1, 2, 3]);
trimf_b = @(x) trimf(x, [2, 5, 6]);
a = trimf_a(x);
b = trimf_b(x);
\end{lstlisting}

\begin{figure}
	\centering
	\includegraphics[width=250pt]{chapters/ch-fuzzy-control-system/figures/exp_createfuzzyset.eps}
	\caption{Create fuzzy sets membership functions for in MATLAB.}
	\label{ch:fcs:fig:exp_createfuzzyset}
\end{figure}

Variables in $\utilde{C}$ is obtained by adding elements in $\utilde{A}$ and $\utilde{B}$. For example, consider $c = 7$. This can be achieved from a set of combinations $a=0, b=7$, $a=0.01, b=6.99$, ..., $a = 7, b = 0$. The membership function, $\mu_{\utilde{C}(7)}$, is a sum of the membership function of all the combinations, where in each combination the associated membership function is obtained by multiplying (this is only one of the ways to handle this problem) the membership functions of $\utilde{A}$ and $\utilde{B}$. Finally, the membership function is normalized by dividing it with its maximum value.

Use the following to calculate the membership function of $\utilde{C}$ as illustrated above. The result is plotted in Fig. \ref{ch:fcs:fig:exp_createfuzzyset} as the magenta line
\begin{lstlisting}[style=Matlab-editor]
	c = conv(a, b, 'full');
	c = c(1:length(x));
	c = c/max(c);
\end{lstlisting}

\subsection{Linguistic Variables}

Fuzzy linguistic system is the language a fuzzy control system uses to record rules and communicate with a human expert knowledge base.

Consider the statement ``sampling frequency is low''. To make sense from this statement, a universe named ``frequency'' must exist, where a fuzzy set ``low frequency'' is defined, whose membership might look like the red curve in Fig. \ref{ch:fcs:fig:explinguistic1}.

\begin{figure}
	\centering
	\includegraphics[width=250pt]{chapters/ch-fuzzy-control-system/figures/explinguistic1.png}
	\caption{Low, medium and high frequency membership functions in common sense.}
	\label{ch:fcs:fig:explinguistic1}
\end{figure}

In Fig. \ref{ch:fcs:fig:explinguistic1}, the considered variable is sampling frequency. The linguistic variables are ``low'', ``medium'' and ``high''. The range of the variable is $[0, 2] (\textup{Hz})$ as far as this problem concerns. Finally, the membership functions of the linguistic variables are given by the curves.

These four features, $(x, T, u, m)$, define a linguistic variable systematically, where $x$, $T$, $u$ and $m$ denote the universe variable name, the linguistic variable name, the range of the universe variable, and the membership of the linguistic variable, respectively.

Interfaces are required to translate from physical signals into fuzzy variables, and backwards from fuzzy variables into physical signals, based on the defined membership functions. They are often regarded as ``fuzzification'' and ``defuzzification'' interfaces, respectively.

\subsection{Fuzzy Inference}

``IF-THEN'' is used to define fuzzy rules, which form the base of the inference system. A commonly used syntax is ``if $x$ is $A$, then $y$ is $B$'', where ``$x$ is $A$'' is the premise, and ``$y$ is $B$'' the consequent. In the case of conventional proposition, the premise ``$x$ is $A$'' is either ``true'' or ``false''. In fuzzy logics, however, the premise can be ``to some extent true''. With the fuzzy variables and fuzzy inference system designed properly, the controller should be able to comprehend to what extend the premise is true, and what actions to take consequently.

Take Fig. \ref{ch:fcs:fig:explinguistic1} as an example. Assume that the input to the system is ``sampling frequency $=0.6Hz$''. A rule is defined that says ``if sampling frequency is low, increase sampling frequency by 50\%''. The controller should be able to draw the conclusion that ``frequency is low'' from the sampling frequency $0.6Hz$ via the fuzzy inference, and increase sampling frequency. Another example is ``if service is good and food is good, then tips is good'', as shown in Fig. \ref{ch:fcs:fig:motivatingexp_fis}.

In a practical fuzzy system, multiple rules are defined. The system should be able to select the best fit entry from the rules. Each rule may be associated with multiple input fuzzy variables, with propositions connected by logic connectors ``AND'', ``OR'', or ``NOT''. The membership function of the joint proposition can be derived from those with individual propositions, using rules such as defined in Table \ref{ch:fcs:tab:fuzzysetoperation}.

The above procedures are summarized in Fig. \ref{ch:fcs:fig:fuzzyschemasimple}. Notice that for multivariable system the input and output physical signals are vectors. Each element in the vectors shall associate with a fuzzy variable. It is also possible to translate multiple fizzy output variables into a single physical output signal, to give it a bit more precision.












